import { Inject, Injectable, RendererStyleFlags2 } from '@angular/core';
import { TinyColor } from '@ctrl/tinycolor';
import { MatCssPalettePrefix } from './model';
import { DOCUMENT } from '@angular/common';
import { DEFAULT_MAT_CSS_CFG } from './default-cfg.const';
import { MATERIAL_CSS_VARS_CFG } from '../mat-css-config-token.const';
import * as i0 from "@angular/core";
// @see: https://github.com/angular/angular/issues/20351
/** @dynamic */
export class MaterialCssVarsService {
    constructor(rendererFactory, document, cfg) {
        this.document = document;
        this.contrastColorThresholdPrimary = '400';
        this.contrastColorThresholdAccent = '400';
        this.contrastColorThresholdWarn = '400';
        this.isAutoContrast = false;
        this.renderer = rendererFactory.createRenderer(null, null);
        this.ROOT = this.document.documentElement;
        this.cfg = {
            ...DEFAULT_MAT_CSS_CFG,
            ...cfg,
        };
        this.isAutoContrast = this.cfg.isAutoContrast;
        if (this.cfg.isDarkTheme) {
            this.setDarkTheme(this.cfg.isDarkTheme);
        }
        if (this.cfg.primary) {
            this.setPrimaryColor(this.cfg.primary);
        }
        if (this.cfg.accent) {
            this.setAccentColor(this.cfg.accent);
        }
        if (this.cfg.warn) {
            this.setWarnColor(this.cfg.warn);
        }
    }
    setPrimaryColor(hex) {
        this.primary = hex;
        const varPrefix = MatCssPalettePrefix.Primary;
        const stylePrimary = this._computePaletteColors(varPrefix, this.primary);
        this._setStyle(stylePrimary);
        if (this.isAutoContrast) {
            this._recalculateAndSetContrastColor(varPrefix);
        }
    }
    setAccentColor(hex) {
        this.accent = hex;
        const varPrefix = MatCssPalettePrefix.Accent;
        const styleAccent = this._computePaletteColors(varPrefix, this.accent);
        this._setStyle(styleAccent);
        if (this.isAutoContrast) {
            this._recalculateAndSetContrastColor(varPrefix);
        }
    }
    setWarnColor(hex) {
        this.warn = hex;
        const varPrefix = MatCssPalettePrefix.Warn;
        const styleWarn = this._computePaletteColors(varPrefix, this.warn);
        this._setStyle(styleWarn);
        if (this.isAutoContrast) {
            this._recalculateAndSetContrastColor(varPrefix);
        }
    }
    setVariable(cssVarName, value) {
        this._setStyle([{
                name: cssVarName,
                val: value,
            }]);
    }
    setDarkTheme(isDark) {
        if (isDark) {
            this.document.body.classList.remove(this.cfg.lightThemeClass);
            this.document.body.classList.add(this.cfg.darkThemeClass);
        }
        else {
            this.document.body.classList.remove(this.cfg.darkThemeClass);
            this.document.body.classList.add(this.cfg.lightThemeClass);
        }
        this.isDarkTheme = isDark;
    }
    setAutoContrastEnabled(val) {
        this.isAutoContrast = val;
        if (val) {
            this._recalculateAndSetContrastColor(MatCssPalettePrefix.Primary);
            this._recalculateAndSetContrastColor(MatCssPalettePrefix.Accent);
            this._recalculateAndSetContrastColor(MatCssPalettePrefix.Warn);
        }
        else {
            this.setContrastColorThresholdPrimary(this.contrastColorThresholdPrimary);
            this.setContrastColorThresholdAccent(this.contrastColorThresholdAccent);
            this.setContrastColorThresholdWarn(this.contrastColorThresholdWarn);
        }
    }
    setContrastColorThresholdPrimary(threshold) {
        this.contrastColorThresholdPrimary = threshold;
        this.setContrastColorThreshold(threshold, MatCssPalettePrefix.Primary);
    }
    setContrastColorThresholdAccent(threshold) {
        this.contrastColorThresholdAccent = threshold;
        this.setContrastColorThreshold(threshold, MatCssPalettePrefix.Accent);
    }
    setContrastColorThresholdWarn(threshold) {
        this.contrastColorThresholdWarn = threshold;
        this.setContrastColorThreshold(threshold, MatCssPalettePrefix.Warn);
    }
    setContrastColorThreshold(threshold, palettePrefix) {
        let color = MaterialCssVarsService.DARK_TEXT_VAR;
        const updates = this.cfg.sortedHues.map((hue) => {
            if (hue === threshold) {
                color = MaterialCssVarsService.LIGHT_TEXT_VAR;
            }
            return {
                val: this._getCssVarValue(color),
                name: `${palettePrefix + MaterialCssVarsService.CONTRAST_PREFIX}${hue}`,
            };
        });
        this._setStyle(updates);
    }
    /**
     * Generate palette color based on traditional values
     */
    setAlternativeColorAlgorithm(traditional) {
        this.cfg.isAlternativeColorAlgorithm = traditional;
        this.setPrimaryColor(this.primary);
        this.setAccentColor(this.accent);
        this.setWarnColor(this.warn);
    }
    /** @deprecated use setContrastColorThresholdPrimary instead */
    changeContrastColorThresholdPrimary(threshold) {
        this.setContrastColorThresholdPrimary(threshold);
    }
    /** @deprecated use setContrastColorThresholdAccent instead */
    changeContrastColorThresholdAccent(threshold) {
        this.setContrastColorThresholdAccent(threshold);
    }
    /** @deprecated use setContrastColorThresholdWarn instead */
    changeContrastColorThresholdWarn(threshold) {
        this.setContrastColorThresholdWarn(threshold);
    }
    /** @deprecated use setContrastColorThreshold instead */
    changeContrastColorThreshold(threshold, palettePrefix) {
        this.setContrastColorThreshold(threshold, palettePrefix);
    }
    getPaletteForColor(hex) {
        if (this.cfg.isAlternativeColorAlgorithm) {
            return this.getTraditionalPaletteForColor(hex);
        }
        else {
            return this.getConstantinPaletteForColor(hex);
        }
    }
    getTraditionalPaletteForColor(hex) {
        return this.cfg.colorMap.map(item => {
            const mappedColor = new TinyColor(hex)
                .lighten(item.map[0])
                .darken(item.map[1])
                .saturate(item.map[2]);
            const c = new TinyColor(mappedColor);
            return {
                hue: item.name,
                isLight: c.isLight(),
                color: {
                    ...c.toRgb(),
                    str: `rgb(${c.toRgb().r},${c.toRgb().g},${c.toRgb().b})`
                }
            };
        });
    }
    getConstantinPaletteForColor(hex) {
        return this.cfg.colorMap.map((item) => {
            const c = this.computePalletTriad(hex, item.name);
            return {
                hue: item.name,
                isLight: c.isLight,
                color: {
                    ...c.rgb,
                    str: `rgb(${c.rgb.r},${c.rgb.g},${c.rgb.b})`
                }
            };
        });
    }
    getPaletteWithContrastForColor(hex) {
        const lightText = this._getCssVarValue(MaterialCssVarsService.LIGHT_TEXT_VAR);
        const darkText = this._getCssVarValue(MaterialCssVarsService.DARK_TEXT_VAR);
        const palette = this.getPaletteForColor(hex);
        // TODO handle non auto case
        return palette.map((item) => {
            const contrastStr = item.isLight
                ? lightText
                : darkText;
            const sLight = contrastStr.split(',').map(v => +v);
            const cco = { r: sLight[0], g: sLight[1], b: sLight[2], a: 1 };
            return {
                ...item,
                contrast: {
                    ...cco,
                    str: `${cco.r},${cco.g},${cco.b}`
                },
            };
        });
    }
    _computePaletteColors(prefix, hex) {
        return this.getPaletteForColor(hex).map(item => {
            const c = item.color;
            return {
                name: `${prefix}${item.hue}`,
                val: `${c.r}, ${c.g}, ${c.b}`
            };
        });
    }
    _recalculateAndSetContrastColor(palettePrefix) {
        const updates = this._calculateContrastColorsForCurrentValues(palettePrefix)
            .map(({ contrastColorVar, hue }) => {
            return {
                val: this._getCssVarValue(contrastColorVar),
                name: `${palettePrefix + MaterialCssVarsService.CONTRAST_PREFIX}${hue}`,
            };
        });
        this._setStyle(updates);
    }
    _calculateContrastColorsForCurrentValues(palettePrefix) {
        return this.cfg.sortedHues.map((hue) => {
            const hueVarVal = this._getCssVarValue(`${palettePrefix}${hue}`);
            const c = new TinyColor(`rgb(${hueVarVal})`);
            const contrastColorVar = c.isDark()
                ? MaterialCssVarsService.LIGHT_TEXT_VAR
                : MaterialCssVarsService.DARK_TEXT_VAR;
            return {
                contrastColorVar,
                hue,
            };
        });
    }
    _setStyle(vars) {
        vars.forEach(s => {
            this.renderer.setStyle(this.ROOT, s.name, s.val, RendererStyleFlags2.DashCase);
        });
    }
    _getCssVarValue(v) {
        return getComputedStyle(this.ROOT).getPropertyValue(v);
    }
    /**
     * Compute pallet colors based on a Triad (Constantin)
     * see: https://github.com/mbitson/mcg
     */
    computePalletTriad(hex, hue) {
        const baseLight = new TinyColor('#ffffff');
        const baseDark = this.multiply(new TinyColor(hex).toRgb(), new TinyColor(hex).toRgb());
        const baseTriad = new TinyColor(hex).tetrad();
        let color;
        switch (hue) {
            case '50':
                color = this.getColorObject(baseLight.mix(hex, 12));
                break;
            case '100':
                color = this.getColorObject(baseLight.mix(hex, 30));
                break;
            case '200':
                color = this.getColorObject(baseLight.mix(hex, 50));
                break;
            case '300':
                color = this.getColorObject(baseLight.mix(hex, 70));
                break;
            case '400':
                color = this.getColorObject(baseLight.mix(hex, 85));
                break;
            case '500':
                color = this.getColorObject(baseLight.mix(hex, 100));
                break;
            case '600':
                color = this.getColorObject(baseDark.mix(hex, 87));
                break;
            case '700':
                color = this.getColorObject(baseDark.mix(hex, 70));
                break;
            case '800':
                color = this.getColorObject(baseDark.mix(hex, 54));
                break;
            case '900':
                color = this.getColorObject(baseDark.mix(hex, 25));
                break;
            case 'A100':
                color = this.getColorObject(baseDark.mix(baseTriad[4], 15).saturate(80).lighten(65));
                break;
            case 'A200':
                color = this.getColorObject(baseDark.mix(baseTriad[4], 15).saturate(80).lighten(55));
                break;
            case 'A400':
                color = this.getColorObject(baseDark.mix(baseTriad[4], 15).saturate(100).lighten(45));
                break;
            case 'A700':
                color = this.getColorObject(baseDark.mix(baseTriad[4], 15).saturate(100).lighten(40));
                break;
            default:
                break;
        }
        return color;
    }
    multiply(rgb1, rgb2) {
        rgb1.b = Math.floor(rgb1.b * rgb2.b / 255);
        rgb1.g = Math.floor(rgb1.g * rgb2.g / 255);
        rgb1.r = Math.floor(rgb1.r * rgb2.r / 255);
        return new TinyColor('rgb ' + rgb1.r + ' ' + rgb1.g + ' ' + rgb1.b);
    }
    getColorObject(value) {
        const c = new TinyColor(value);
        return { rgb: c.toRgb(), isLight: c.isLight() };
    }
}
MaterialCssVarsService.CONTRAST_PREFIX = 'contrast-';
MaterialCssVarsService.DARK_TEXT_VAR = '--dark-primary-text';
MaterialCssVarsService.LIGHT_TEXT_VAR = '--light-primary-text';
MaterialCssVarsService.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.0.0", ngImport: i0, type: MaterialCssVarsService, deps: [{ token: i0.RendererFactory2 }, { token: DOCUMENT }, { token: MATERIAL_CSS_VARS_CFG }], target: i0.ɵɵFactoryTarget.Injectable });
MaterialCssVarsService.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "13.0.0", ngImport: i0, type: MaterialCssVarsService, providedIn: 'root' });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.0.0", ngImport: i0, type: MaterialCssVarsService, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root'
                }]
        }], ctorParameters: function () { return [{ type: i0.RendererFactory2 }, { type: Document, decorators: [{
                    type: Inject,
                    args: [DOCUMENT]
                }] }, { type: undefined, decorators: [{
                    type: Inject,
                    args: [MATERIAL_CSS_VARS_CFG]
                }] }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWF0ZXJpYWwtY3NzLXZhcnMuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Byb2plY3RzL21hdGVyaWFsLWNzcy12YXJzL3NyYy9saWIvbWF0ZXJpYWwtY3NzLXZhcnMuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUMsTUFBTSxFQUFFLFVBQVUsRUFBK0IsbUJBQW1CLEVBQUMsTUFBTSxlQUFlLENBQUM7QUFDbkcsT0FBTyxFQUFrQixTQUFTLEVBQUMsTUFBTSxpQkFBaUIsQ0FBQztBQUMzRCxPQUFPLEVBSUwsbUJBQW1CLEVBR3BCLE1BQU0sU0FBUyxDQUFDO0FBQ2pCLE9BQU8sRUFBQyxRQUFRLEVBQUMsTUFBTSxpQkFBaUIsQ0FBQztBQUN6QyxPQUFPLEVBQUMsbUJBQW1CLEVBQUMsTUFBTSxxQkFBcUIsQ0FBQztBQUN4RCxPQUFPLEVBQUMscUJBQXFCLEVBQUMsTUFBTSwrQkFBK0IsQ0FBQzs7QUFPcEUsd0RBQXdEO0FBQ3hELGVBQWU7QUFJZixNQUFNLE9BQU8sc0JBQXNCO0lBbUJqQyxZQUNFLGVBQWlDLEVBQ1AsUUFBa0IsRUFDYixHQUErQjtRQURwQyxhQUFRLEdBQVIsUUFBUSxDQUFVO1FBUDlDLGtDQUE2QixHQUFhLEtBQUssQ0FBQztRQUNoRCxpQ0FBNEIsR0FBYSxLQUFLLENBQUM7UUFDL0MsK0JBQTBCLEdBQWEsS0FBSyxDQUFDO1FBQzdDLG1CQUFjLEdBQUcsS0FBSyxDQUFDO1FBT3JCLElBQUksQ0FBQyxRQUFRLEdBQUcsZUFBZSxDQUFDLGNBQWMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDM0QsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLGVBQWUsQ0FBQztRQUUxQyxJQUFJLENBQUMsR0FBRyxHQUFHO1lBQ1QsR0FBRyxtQkFBbUI7WUFDdEIsR0FBRyxHQUFHO1NBQ1AsQ0FBQztRQUNGLElBQUksQ0FBQyxj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QUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQztRQUMzQyxPQUFPLElBQUksU0FBUyxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsQ0FBQyxHQUFHLEdBQUcsR0FBRyxJQUFJLENBQUMsQ0FBQyxHQUFHLEdBQUcsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDdEUsQ0FBQztJQUVPLGNBQWMsQ0FBQyxLQUFnQjtRQUNyQyxNQUFNLENBQUMsR0FBRyxJQUFJLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUMvQixPQUFPLEVBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxLQUFLLEVBQUUsRUFBRSxPQUFPLEVBQUUsQ0FBQyxDQUFDLE9BQU8sRUFBRSxFQUFDLENBQUM7SUFDaEQsQ0FBQzs7QUEzVmMsc0NBQWUsR0FBRyxXQUFZLENBQUE7QUFDOUIsb0NBQWEsR0FBRyxxQkFBc0IsQ0FBQTtBQUN0QyxxQ0FBYyxHQUFHLHNCQUF1QixDQUFBO21IQUg1QyxzQkFBc0Isa0RBcUJ2QixRQUFRLGFBQ1IscUJBQXFCO3VIQXRCcEIsc0JBQXNCLGNBRnJCLE1BQU07MkZBRVAsc0JBQXNCO2tCQUhsQyxVQUFVO21CQUFDO29CQUNWLFVBQVUsRUFBRSxNQUFNO2lCQUNuQjt5RkFzQnVDLFFBQVE7MEJBQTNDLE1BQU07MkJBQUMsUUFBUTs7MEJBQ2YsTUFBTTsyQkFBQyxxQkFBcUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0luamVjdCwgSW5qZWN0YWJsZSwgUmVuZGVyZXIyLCBSZW5kZXJlckZhY3RvcnkyLCBSZW5kZXJlclN0eWxlRmxhZ3MyfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7TnVtYmVyaWZ5LCBSR0JBLCBUaW55Q29sb3J9IGZyb20gJ0BjdHJsL3Rpbnljb2xvcic7XG5pbXBvcnQge1xuICBIdWVWYWx1ZSxcbiAgTWF0Q3NzSHVlQ29sb3JDb250cmFzdE1hcEl0ZW0sXG4gIE1hdENzc0h1ZUNvbG9yTWFwSXRlbSxcbiAgTWF0Q3NzUGFsZXR0ZVByZWZpeCxcbiAgTWF0ZXJpYWxDc3NWYXJpYWJsZXMsXG4gIE1hdGVyaWFsQ3NzVmFyaWFibGVzQ29uZmlnXG59IGZyb20gJy4vbW9kZWwnO1xuaW1wb3J0IHtET0NVTUVOVH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7REVGQVVMVF9NQVRfQ1NTX0NGR30gZnJvbSAnLi9kZWZhdWx0LWNmZy5jb25zdCc7XG5pbXBvcnQge01BVEVSSUFMX0NTU19WQVJTX0NGR30gZnJvbSAnLi4vbWF0LWNzcy1jb25maWctdG9rZW4uY29uc3QnO1xuXG5pbnRlcmZhY2UgQ3NzVmFyaWFibGUge1xuICBuYW1lOiBzdHJpbmc7XG4gIHZhbDogc3RyaW5nO1xufVxuXG4vLyBAc2VlOiBodHRwczovL2dpdGh1Yi5jb20vYW5ndWxhci9hbmd1bGFyL2lzc3Vlcy8yMDM1MVxuLyoqIEBkeW5hbWljICovXG5ASW5qZWN0YWJsZSh7XG4gIHByb3ZpZGVkSW46ICdyb290J1xufSlcbmV4cG9ydCBjbGFzcyBNYXRlcmlhbENzc1ZhcnNTZXJ2aWNlIHtcbiAgcHJpdmF0ZSBzdGF0aWMgQ09OVFJBU1RfUFJFRklYID0gJ2NvbnRyYXN0LSc7XG4gIHByaXZhdGUgc3RhdGljIERBUktfVEVYVF9WQVIgPSAnLS1kYXJrLXByaW1hcnktdGV4dCc7XG4gIHByaXZhdGUgc3RhdGljIExJR0hUX1RFWFRfVkFSID0gJy0tbGlnaHQtcHJpbWFyeS10ZXh0JztcblxuICBwcml2YXRlIHJlbmRlcmVyOiBSZW5kZXJlcjI7XG4gIHByaXZhdGUgUk9PVDogSFRNTEVsZW1lbnQ7XG5cbiAgLy8gVGhpcyBzaG91bGQgYmUgcmVhZG9ubHkgZnJvbSB0aGUgb3V0c2lkZVxuICBjZmc6IE1hdGVyaWFsQ3NzVmFyaWFibGVzQ29uZmlnO1xuICBwcmltYXJ5OiBzdHJpbmc7XG4gIGFjY2VudDogc3RyaW5nO1xuICB3YXJuOiBzdHJpbmc7XG4gIGlzRGFya1RoZW1lOiBib29sZWFuO1xuICBjb250cmFzdENvbG9yVGhyZXNob2xkUHJpbWFyeTogSHVlVmFsdWUgPSAnNDAwJztcbiAgY29udHJhc3RDb2xvclRocmVzaG9sZEFjY2VudDogSHVlVmFsdWUgPSAnNDAwJztcbiAgY29udHJhc3RDb2xvclRocmVzaG9sZFdhcm46IEh1ZVZhbHVlID0gJzQwMCc7XG4gIGlzQXV0b0NvbnRyYXN0ID0gZmFsc2U7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcmVuZGVyZXJGYWN0b3J5OiBSZW5kZXJlckZhY3RvcnkyLFxuICAgIEBJbmplY3QoRE9DVU1FTlQpIHByaXZhdGUgZG9jdW1lbnQ6IERvY3VtZW50LFxuICAgIEBJbmplY3QoTUFURVJJQUxfQ1NTX1ZBUlNfQ0ZHKSBjZmc6IE1hdGVyaWFsQ3NzVmFyaWFibGVzQ29uZmlnLFxuICApIHtcbiAgICB0aGlzLnJlbmRlcmVyID0gcmVuZGVyZXJGYWN0b3J5LmNyZWF0ZVJlbmRlcmVyKG51bGwsIG51bGwpO1xuICAgIHRoaXMuUk9PVCA9IHRoaXMuZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50O1xuXG4gICAgdGhpcy5jZmcgPSB7XG4gICAgICAuLi5ERUZBVUxUX01BVF9DU1NfQ0ZHLFxuICAgICAgLi4uY2ZnLFxuICAgIH07XG4gICAgdGhpcy5pc0F1dG9Db250cmFzdCA9IHRoaXMuY2ZnLmlzQXV0b0NvbnRyYXN0O1xuXG4gICAgaWYgKHRoaXMuY2ZnLmlzRGFya1RoZW1lKSB7XG4gICAgICB0aGlzLnNldERhcmtUaGVtZSh0aGlzLmNmZy5pc0RhcmtUaGVtZSk7XG4gICAgfVxuICAgIGlmICh0aGlzLmNmZy5wcmltYXJ5KSB7XG4gICAgICB0aGlzLnNldFByaW1hcnlDb2xvcih0aGlzLmNmZy5wcmltYXJ5KTtcbiAgICB9XG4gICAgaWYgKHRoaXMuY2ZnLmFjY2VudCkge1xuICAgICAgdGhpcy5zZXRBY2NlbnRDb2xvcih0aGlzLmNmZy5hY2NlbnQpO1xuICAgIH1cbiAgICBpZiAodGhpcy5jZmcud2Fybikge1xuICAgICAgdGhpcy5zZXRXYXJuQ29sb3IodGhpcy5jZmcud2Fybik7XG4gICAgfVxuICB9XG5cbiAgc2V0UHJpbWFyeUNvbG9yKGhleDogc3RyaW5nKSB7XG4gICAgdGhpcy5wcmltYXJ5ID0gaGV4O1xuICAgIGNvbnN0IHZhclByZWZpeCA9IE1hdENzc1BhbGV0dGVQcmVmaXguUHJpbWFyeTtcbiAgICBjb25zdCBzdHlsZVByaW1hcnkgPSB0aGlzLl9jb21wdXRlUGFsZXR0ZUNvbG9ycyh2YXJQcmVmaXgsIHRoaXMucHJpbWFyeSk7XG4gICAgdGhpcy5fc2V0U3R5bGUoc3R5bGVQcmltYXJ5KTtcblxuICAgIGlmICh0aGlzLmlzQXV0b0NvbnRyYXN0KSB7XG4gICAgICB0aGlzLl9yZWNhbGN1bGF0ZUFuZFNldENvbnRyYXN0Q29sb3IodmFyUHJlZml4KTtcbiAgICB9XG4gIH1cblxuICBzZXRBY2NlbnRDb2xvcihoZXg6IHN0cmluZykge1xuICAgIHRoaXMuYWNjZW50ID0gaGV4O1xuICAgIGNvbnN0IHZhclByZWZpeCA9IE1hdENzc1BhbGV0dGVQcmVmaXguQWNjZW50O1xuICAgIGNvbnN0IHN0eWxlQWNjZW50ID0gdGhpcy5fY29tcHV0ZVBhbGV0dGVDb2xvcnModmFyUHJlZml4LCB0aGlzLmFjY2VudCk7XG4gICAgdGhpcy5fc2V0U3R5bGUoc3R5bGVBY2NlbnQpO1xuXG4gICAgaWYgKHRoaXMuaXNBdXRvQ29udHJhc3QpIHtcbiAgICAgIHRoaXMuX3JlY2FsY3VsYXRlQW5kU2V0Q29udHJhc3RDb2xvcih2YXJQcmVmaXgpO1xuICAgIH1cbiAgfVxuXG4gIHNldFdhcm5Db2xvcihoZXg6IHN0cmluZykge1xuICAgIHRoaXMud2FybiA9IGhleDtcbiAgICBjb25zdCB2YXJQcmVmaXggPSBNYXRDc3NQYWxldHRlUHJlZml4Lldhcm47XG4gICAgY29uc3Qgc3R5bGVXYXJuID0gdGhpcy5fY29tcHV0ZVBhbGV0dGVDb2xvcnModmFyUHJlZml4LCB0aGlzLndhcm4pO1xuICAgIHRoaXMuX3NldFN0eWxlKHN0eWxlV2Fybik7XG5cbiAgICBpZiAodGhpcy5pc0F1dG9Db250cmFzdCkge1xuICAgICAgdGhpcy5fcmVjYWxjdWxhdGVBbmRTZXRDb250cmFzdENvbG9yKHZhclByZWZpeCk7XG4gICAgfVxuICB9XG5cbiAgc2V0VmFyaWFibGUoY3NzVmFyTmFtZTogTWF0ZXJpYWxDc3NWYXJpYWJsZXMsIHZhbHVlOiBzdHJpbmcpIHtcbiAgICB0aGlzLl9zZXRTdHlsZShbe1xuICAgICAgbmFtZTogY3NzVmFyTmFtZSxcbiAgICAgIHZhbDogdmFsdWUsXG4gICAgfV0pO1xuICB9XG5cbiAgc2V0RGFya1RoZW1lKGlzRGFyazogYm9vbGVhbikge1xuICAgIGlmIChpc0RhcmspIHtcbiAgICAgIHRoaXMuZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuY2ZnLmxpZ2h0VGhlbWVDbGFzcyk7XG4gICAgICB0aGlzLmRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmFkZCh0aGlzLmNmZy5kYXJrVGhlbWVDbGFzcyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuY2ZnLmRhcmtUaGVtZUNsYXNzKTtcbiAgICAgIHRoaXMuZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QuYWRkKHRoaXMuY2ZnLmxpZ2h0VGhlbWVDbGFzcyk7XG4gICAgfVxuICAgIHRoaXMuaXNEYXJrVGhlbWUgPSBpc0Rhcms7XG4gIH1cblxuICBzZXRBdXRvQ29udHJhc3RFbmFibGVkKHZhbDogYm9vbGVhbikge1xuICAgIHRoaXMuaXNBdXRvQ29udHJhc3QgPSB2YWw7XG4gICAgaWYgKHZhbCkge1xuICAgICAgdGhpcy5fcmVjYWxjdWxhdGVBbmRTZXRDb250cmFzdENvbG9yKE1hdENzc1BhbGV0dGVQcmVmaXguUHJpbWFyeSk7XG4gICAgICB0aGlzLl9yZWNhbGN1bGF0ZUFuZFNldENvbnRyYXN0Q29sb3IoTWF0Q3NzUGFsZXR0ZVByZWZpeC5BY2NlbnQpO1xuICAgICAgdGhpcy5fcmVjYWxjdWxhdGVBbmRTZXRDb250cmFzdENvbG9yKE1hdENzc1BhbGV0dGVQcmVmaXguV2Fybik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc2V0Q29udHJhc3RDb2xvclRocmVzaG9sZFByaW1hcnkodGhpcy5jb250cmFzdENvbG9yVGhyZXNob2xkUHJpbWFyeSk7XG4gICAgICB0aGlzLnNldENvbnRyYXN0Q29sb3JUaHJlc2hvbGRBY2NlbnQodGhpcy5jb250cmFzdENvbG9yVGhyZXNob2xkQWNjZW50KTtcbiAgICAgIHRoaXMuc2V0Q29udHJhc3RDb2xvclRocmVzaG9sZFdhcm4odGhpcy5jb250cmFzdENvbG9yVGhyZXNob2xkV2Fybik7XG4gICAgfVxuICB9XG5cbiAgc2V0Q29udHJhc3RDb2xvclRocmVzaG9sZFByaW1hcnkodGhyZXNob2xkOiBIdWVWYWx1ZSkge1xuICAgIHRoaXMuY29udHJhc3RDb2xvclRocmVzaG9sZFByaW1hcnkgPSB0aHJlc2hvbGQ7XG4gICAgdGhpcy5zZXRDb250cmFzdENvbG9yVGhyZXNob2xkKHRocmVzaG9sZCwgTWF0Q3NzUGFsZXR0ZVByZWZpeC5QcmltYXJ5KTtcbiAgfVxuXG4gIHNldENvbnRyYXN0Q29sb3JUaHJlc2hvbGRBY2NlbnQodGhyZXNob2xkOiBIdWVWYWx1ZSkge1xuICAgIHRoaXMuY29udHJhc3RDb2xvclRocmVzaG9sZEFjY2VudCA9IHRocmVzaG9sZDtcbiAgICB0aGlzLnNldENvbnRyYXN0Q29sb3JUaHJlc2hvbGQodGhyZXNob2xkLCBNYXRDc3NQYWxldHRlUHJlZml4LkFjY2VudCk7XG4gIH1cblxuICBzZXRDb250cmFzdENvbG9yVGhyZXNob2xkV2Fybih0aHJlc2hvbGQ6IEh1ZVZhbHVlKSB7XG4gICAgdGhpcy5jb250cmFzdENvbG9yVGhyZXNob2xkV2FybiA9IHRocmVzaG9sZDtcbiAgICB0aGlzLnNldENvbnRyYXN0Q29sb3JUaHJlc2hvbGQodGhyZXNob2xkLCBNYXRDc3NQYWxldHRlUHJlZml4Lldhcm4pO1xuICB9XG5cbiAgc2V0Q29udHJhc3RDb2xvclRocmVzaG9sZCh0aHJlc2hvbGQ6IEh1ZVZhbHVlLCBwYWxldHRlUHJlZml4OiBNYXRDc3NQYWxldHRlUHJlZml4KSB7XG4gICAgbGV0IGNvbG9yID0gTWF0ZXJpYWxDc3NWYXJzU2VydmljZS5EQVJLX1RFWFRfVkFSO1xuICAgIGNvbnN0IHVwZGF0ZXMgPSB0aGlzLmNmZy5zb3J0ZWRIdWVzLm1hcCgoaHVlKSA9PiB7XG4gICAgICBpZiAoaHVlID09PSB0aHJlc2hvbGQpIHtcbiAgICAgICAgY29sb3IgPSBNYXRlcmlhbENzc1ZhcnNTZXJ2aWNlLkxJR0hUX1RFWFRfVkFSO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdmFsOiB0aGlzLl9nZXRDc3NWYXJWYWx1ZShjb2xvciksXG4gICAgICAgIG5hbWU6IGAke3BhbGV0dGVQcmVmaXggKyBNYXRlcmlhbENzc1ZhcnNTZXJ2aWNlLkNPTlRSQVNUX1BSRUZJWH0ke2h1ZX1gLFxuICAgICAgfTtcbiAgICB9KTtcbiAgICB0aGlzLl9zZXRTdHlsZSh1cGRhdGVzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSBwYWxldHRlIGNvbG9yIGJhc2VkIG9uIHRyYWRpdGlvbmFsIHZhbHVlc1xuICAgKi9cbiAgc2V0QWx0ZXJuYXRpdmVDb2xvckFsZ29yaXRobSh0cmFkaXRpb25hbDogYm9vbGVhbik6IHZvaWQge1xuICAgIHRoaXMuY2ZnLmlzQWx0ZXJuYXRpdmVDb2xvckFsZ29yaXRobSA9IHRyYWRpdGlvbmFsO1xuICAgIHRoaXMuc2V0UHJpbWFyeUNvbG9yKHRoaXMucHJpbWFyeSk7XG4gICAgdGhpcy5zZXRBY2NlbnRDb2xvcih0aGlzLmFjY2VudCk7XG4gICAgdGhpcy5zZXRXYXJuQ29sb3IodGhpcy53YXJuKTtcbiAgfVxuXG4gIC8qKiBAZGVwcmVjYXRlZCB1c2Ugc2V0Q29udHJhc3RDb2xvclRocmVzaG9sZFByaW1hcnkgaW5zdGVhZCAqL1xuICBjaGFuZ2VDb250cmFzdENvbG9yVGhyZXNob2xkUHJpbWFyeSh0aHJlc2hvbGQ6IEh1ZVZhbHVlKSB7XG4gICAgdGhpcy5zZXRDb250cmFzdENvbG9yVGhyZXNob2xkUHJpbWFyeSh0aHJlc2hvbGQpO1xuICB9XG5cbiAgLyoqIEBkZXByZWNhdGVkIHVzZSBzZXRDb250cmFzdENvbG9yVGhyZXNob2xkQWNjZW50IGluc3RlYWQgKi9cbiAgY2hhbmdlQ29udHJhc3RDb2xvclRocmVzaG9sZEFjY2VudCh0aHJlc2hvbGQ6IEh1ZVZhbHVlKSB7XG4gICAgdGhpcy5zZXRDb250cmFzdENvbG9yVGhyZXNob2xkQWNjZW50KHRocmVzaG9sZCk7XG4gIH1cblxuICAvKiogQGRlcHJlY2F0ZWQgdXNlIHNldENvbnRyYXN0Q29sb3JUaHJlc2hvbGRXYXJuIGluc3RlYWQgKi9cbiAgY2hhbmdlQ29udHJhc3RDb2xvclRocmVzaG9sZFdhcm4odGhyZXNob2xkOiBIdWVWYWx1ZSkge1xuICAgIHRoaXMuc2V0Q29udHJhc3RDb2xvclRocmVzaG9sZFdhcm4odGhyZXNob2xkKTtcbiAgfVxuXG4gIC8qKiBAZGVwcmVjYXRlZCB1c2Ugc2V0Q29udHJhc3RDb2xvclRocmVzaG9sZCBpbnN0ZWFkICovXG4gIGNoYW5nZUNvbnRyYXN0Q29sb3JUaHJlc2hvbGQodGhyZXNob2xkOiBIdWVWYWx1ZSwgcGFsZXR0ZVByZWZpeDogTWF0Q3NzUGFsZXR0ZVByZWZpeCkge1xuICAgIHRoaXMuc2V0Q29udHJhc3RDb2xvclRocmVzaG9sZCh0aHJlc2hvbGQsIHBhbGV0dGVQcmVmaXgpO1xuICB9XG5cbiAgZ2V0UGFsZXR0ZUZvckNvbG9yKGhleDogc3RyaW5nKTogTWF0Q3NzSHVlQ29sb3JNYXBJdGVtW10ge1xuICAgIGlmICh0aGlzLmNmZy5pc0FsdGVybmF0aXZlQ29sb3JBbGdvcml0aG0pIHtcbiAgICAgIHJldHVybiB0aGlzLmdldFRyYWRpdGlvbmFsUGFsZXR0ZUZvckNvbG9yKGhleCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB0aGlzLmdldENvbnN0YW50aW5QYWxldHRlRm9yQ29sb3IoaGV4KTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdldFRyYWRpdGlvbmFsUGFsZXR0ZUZvckNvbG9yKGhleDogc3RyaW5nKTogTWF0Q3NzSHVlQ29sb3JNYXBJdGVtW10ge1xuICAgIHJldHVybiB0aGlzLmNmZy5jb2xvck1hcC5tYXAoaXRlbSA9PiB7XG4gICAgICBjb25zdCBtYXBwZWRDb2xvciA9IG5ldyBUaW55Q29sb3IoaGV4KVxuICAgICAgICAubGlnaHRlbihpdGVtLm1hcFswXSlcbiAgICAgICAgLmRhcmtlbihpdGVtLm1hcFsxXSlcbiAgICAgICAgLnNhdHVyYXRlKGl0ZW0ubWFwWzJdKTtcbiAgICAgIGNvbnN0IGMgPSBuZXcgVGlueUNvbG9yKG1hcHBlZENvbG9yKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGh1ZTogaXRlbS5uYW1lLFxuICAgICAgICBpc0xpZ2h0OiBjLmlzTGlnaHQoKSxcbiAgICAgICAgY29sb3I6IHtcbiAgICAgICAgICAuLi5jLnRvUmdiKCksXG4gICAgICAgICAgc3RyOiBgcmdiKCR7Yy50b1JnYigpLnJ9LCR7Yy50b1JnYigpLmd9LCR7Yy50b1JnYigpLmJ9KWBcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0Q29uc3RhbnRpblBhbGV0dGVGb3JDb2xvcihoZXg6IHN0cmluZyk6IE1hdENzc0h1ZUNvbG9yTWFwSXRlbVtdIHtcbiAgICByZXR1cm4gdGhpcy5jZmcuY29sb3JNYXAubWFwKChpdGVtKSA9PiB7XG4gICAgICBjb25zdCBjID0gdGhpcy5jb21wdXRlUGFsbGV0VHJpYWQoaGV4LCBpdGVtLm5hbWUpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaHVlOiBpdGVtLm5hbWUsXG4gICAgICAgIGlzTGlnaHQ6IGMuaXNMaWdodCxcbiAgICAgICAgY29sb3I6IHtcbiAgICAgICAgICAuLi5jLnJnYixcbiAgICAgICAgICBzdHI6IGByZ2IoJHtjLnJnYi5yfSwke2MucmdiLmd9LCR7Yy5yZ2IuYn0pYFxuICAgICAgICB9XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgZ2V0UGFsZXR0ZVdpdGhDb250cmFzdEZvckNvbG9yKGhleDogc3RyaW5nKTogTWF0Q3NzSHVlQ29sb3JDb250cmFzdE1hcEl0ZW1bXSB7XG4gICAgY29uc3QgbGlnaHRUZXh0ID0gdGhpcy5fZ2V0Q3NzVmFyVmFsdWUoTWF0ZXJpYWxDc3NWYXJzU2VydmljZS5MSUdIVF9URVhUX1ZBUik7XG4gICAgY29uc3QgZGFya1RleHQgPSB0aGlzLl9nZXRDc3NWYXJWYWx1ZShNYXRlcmlhbENzc1ZhcnNTZXJ2aWNlLkRBUktfVEVYVF9WQVIpO1xuICAgIGNvbnN0IHBhbGV0dGUgPSB0aGlzLmdldFBhbGV0dGVGb3JDb2xvcihoZXgpO1xuXG4gICAgLy8gVE9ETyBoYW5kbGUgbm9uIGF1dG8gY2FzZVxuICAgIHJldHVybiBwYWxldHRlLm1hcCgoaXRlbSkgPT4ge1xuICAgICAgY29uc3QgY29udHJhc3RTdHIgPSBpdGVtLmlzTGlnaHRcbiAgICAgICAgPyBsaWdodFRleHRcbiAgICAgICAgOiBkYXJrVGV4dDtcblxuICAgICAgY29uc3Qgc0xpZ2h0ID0gY29udHJhc3RTdHIuc3BsaXQoJywnKS5tYXAodiA9PiArdik7XG4gICAgICBjb25zdCBjY28gPSB7cjogc0xpZ2h0WzBdLCBnOiBzTGlnaHRbMV0sIGI6IHNMaWdodFsyXSwgYTogMX07XG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5pdGVtLFxuICAgICAgICBjb250cmFzdDoge1xuICAgICAgICAgIC4uLmNjbyxcbiAgICAgICAgICBzdHI6IGAke2Njby5yfSwke2Njby5nfSwke2Njby5ifWBcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIF9jb21wdXRlUGFsZXR0ZUNvbG9ycyhwcmVmaXg6IE1hdENzc1BhbGV0dGVQcmVmaXgsIGhleDogc3RyaW5nKTogQ3NzVmFyaWFibGVbXSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0UGFsZXR0ZUZvckNvbG9yKGhleCkubWFwKGl0ZW0gPT4ge1xuICAgICAgY29uc3QgYyA9IGl0ZW0uY29sb3I7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBuYW1lOiBgJHtwcmVmaXh9JHtpdGVtLmh1ZX1gLFxuICAgICAgICB2YWw6IGAke2Mucn0sICR7Yy5nfSwgJHtjLmJ9YFxuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgX3JlY2FsY3VsYXRlQW5kU2V0Q29udHJhc3RDb2xvcihwYWxldHRlUHJlZml4OiBNYXRDc3NQYWxldHRlUHJlZml4KSB7XG4gICAgY29uc3QgdXBkYXRlcyA9IHRoaXMuX2NhbGN1bGF0ZUNvbnRyYXN0Q29sb3JzRm9yQ3VycmVudFZhbHVlcyhwYWxldHRlUHJlZml4KVxuICAgICAgLm1hcCgoe2NvbnRyYXN0Q29sb3JWYXIsIGh1ZX0pID0+IHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB2YWw6IHRoaXMuX2dldENzc1ZhclZhbHVlKGNvbnRyYXN0Q29sb3JWYXIpLFxuICAgICAgICAgIG5hbWU6IGAke3BhbGV0dGVQcmVmaXggKyBNYXRlcmlhbENzc1ZhcnNTZXJ2aWNlLkNPTlRSQVNUX1BSRUZJWH0ke2h1ZX1gLFxuICAgICAgICB9O1xuICAgICAgfSk7XG4gICAgdGhpcy5fc2V0U3R5bGUodXBkYXRlcyk7XG4gIH1cblxuICBwcml2YXRlIF9jYWxjdWxhdGVDb250cmFzdENvbG9yc0ZvckN1cnJlbnRWYWx1ZXMocGFsZXR0ZVByZWZpeDogTWF0Q3NzUGFsZXR0ZVByZWZpeCk6XG4gICAgeyBjb250cmFzdENvbG9yVmFyOiBzdHJpbmcsIGh1ZTogSHVlVmFsdWUgfVtdIHtcbiAgICByZXR1cm4gdGhpcy5jZmcuc29ydGVkSHVlcy5tYXAoKGh1ZSkgPT4ge1xuICAgICAgY29uc3QgaHVlVmFyVmFsID0gdGhpcy5fZ2V0Q3NzVmFyVmFsdWUoYCR7cGFsZXR0ZVByZWZpeH0ke2h1ZX1gKTtcbiAgICAgIGNvbnN0IGMgPSBuZXcgVGlueUNvbG9yKGByZ2IoJHtodWVWYXJWYWx9KWApO1xuICAgICAgY29uc3QgY29udHJhc3RDb2xvclZhciA9IGMuaXNEYXJrKClcbiAgICAgICAgPyBNYXRlcmlhbENzc1ZhcnNTZXJ2aWNlLkxJR0hUX1RFWFRfVkFSXG4gICAgICAgIDogTWF0ZXJpYWxDc3NWYXJzU2VydmljZS5EQVJLX1RFWFRfVkFSO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgY29udHJhc3RDb2xvclZhcixcbiAgICAgICAgaHVlLFxuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgX3NldFN0eWxlKHZhcnM6IENzc1ZhcmlhYmxlW10pIHtcbiAgICB2YXJzLmZvckVhY2gocyA9PiB7XG4gICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMuUk9PVCwgcy5uYW1lLCBzLnZhbCwgUmVuZGVyZXJTdHlsZUZsYWdzMi5EYXNoQ2FzZSk7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIF9nZXRDc3NWYXJWYWx1ZSh2OiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIHJldHVybiBnZXRDb21wdXRlZFN0eWxlKHRoaXMuUk9PVCkuZ2V0UHJvcGVydHlWYWx1ZSh2KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb21wdXRlIHBhbGxldCBjb2xvcnMgYmFzZWQgb24gYSBUcmlhZCAoQ29uc3RhbnRpbilcbiAgICogc2VlOiBodHRwczovL2dpdGh1Yi5jb20vbWJpdHNvbi9tY2dcbiAgICovXG4gIHByaXZhdGUgY29tcHV0ZVBhbGxldFRyaWFkKGhleDogc3RyaW5nLCBodWU6IEh1ZVZhbHVlKSB7XG4gICAgY29uc3QgYmFzZUxpZ2h0ID0gbmV3IFRpbnlDb2xvcignI2ZmZmZmZicpO1xuICAgIGNvbnN0IGJhc2VEYXJrID0gdGhpcy5tdWx0aXBseShuZXcgVGlueUNvbG9yKGhleCkudG9SZ2IoKSwgbmV3IFRpbnlDb2xvcihoZXgpLnRvUmdiKCkpO1xuICAgIGNvbnN0IGJhc2VUcmlhZCA9IG5ldyBUaW55Q29sb3IoaGV4KS50ZXRyYWQoKTtcbiAgICBsZXQgY29sb3I6IHsgcmdiOiBOdW1iZXJpZnk8UkdCQT4sIGlzTGlnaHQ6IGJvb2xlYW4gfTtcblxuICAgIHN3aXRjaCAoaHVlKSB7XG4gICAgICBjYXNlICc1MCc6XG4gICAgICAgIGNvbG9yID0gdGhpcy5nZXRDb2xvck9iamVjdChiYXNlTGlnaHQubWl4KGhleCwgMTIpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICcxMDAnOlxuICAgICAgICBjb2xvciA9IHRoaXMuZ2V0Q29sb3JPYmplY3QoYmFzZUxpZ2h0Lm1peChoZXgsIDMwKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnMjAwJzpcbiAgICAgICAgY29sb3IgPSB0aGlzLmdldENvbG9yT2JqZWN0KGJhc2VMaWdodC5taXgoaGV4LCA1MCkpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJzMwMCc6XG4gICAgICAgIGNvbG9yID0gdGhpcy5nZXRDb2xvck9iamVjdChiYXNlTGlnaHQubWl4KGhleCwgNzApKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICc0MDAnOlxuICAgICAgICBjb2xvciA9IHRoaXMuZ2V0Q29sb3JPYmplY3QoYmFzZUxpZ2h0Lm1peChoZXgsIDg1KSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnNTAwJzpcbiAgICAgICAgY29sb3IgPSB0aGlzLmdldENvbG9yT2JqZWN0KGJhc2VMaWdodC5taXgoaGV4LCAxMDApKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICc2MDAnOlxuICAgICAgICBjb2xvciA9IHRoaXMuZ2V0Q29sb3JPYmplY3QoYmFzZURhcmsubWl4KGhleCwgODcpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICc3MDAnOlxuICAgICAgICBjb2xvciA9IHRoaXMuZ2V0Q29sb3JPYmplY3QoYmFzZURhcmsubWl4KGhleCwgNzApKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICc4MDAnOlxuICAgICAgICBjb2xvciA9IHRoaXMuZ2V0Q29sb3JPYmplY3QoYmFzZURhcmsubWl4KGhleCwgNTQpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICc5MDAnOlxuICAgICAgICBjb2xvciA9IHRoaXMuZ2V0Q29sb3JPYmplY3QoYmFzZURhcmsubWl4KGhleCwgMjUpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdBMTAwJzpcbiAgICAgICAgY29sb3IgPSB0aGlzLmdldENvbG9yT2JqZWN0KGJhc2VEYXJrLm1peChiYXNlVHJpYWRbNF0sIDE1KS5zYXR1cmF0ZSg4MCkubGlnaHRlbig2NSkpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ0EyMDAnOlxuICAgICAgICBjb2xvciA9IHRoaXMuZ2V0Q29sb3JPYmplY3QoYmFzZURhcmsubWl4KGJhc2VUcmlhZFs0XSwgMTUpLnNhdHVyYXRlKDgwKS5saWdodGVuKDU1KSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnQTQwMCc6XG4gICAgICAgIGNvbG9yID0gdGhpcy5nZXRDb2xvck9iamVjdChiYXNlRGFyay5taXgoYmFzZVRyaWFkWzRdLCAxNSkuc2F0dXJhdGUoMTAwKS5saWdodGVuKDQ1KSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnQTcwMCc6XG4gICAgICAgIGNvbG9yID0gdGhpcy5nZXRDb2xvck9iamVjdChiYXNlRGFyay5taXgoYmFzZVRyaWFkWzRdLCAxNSkuc2F0dXJhdGUoMTAwKS5saWdodGVuKDQwKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICAgIHJldHVybiBjb2xvcjtcbiAgfVxuXG4gIHByaXZhdGUgbXVsdGlwbHkocmdiMTogTnVtYmVyaWZ5PFJHQkE+LCByZ2IyOiBOdW1iZXJpZnk8UkdCQT4pOiBUaW55Q29sb3Ige1xuICAgIHJnYjEuYiA9IE1hdGguZmxvb3IocmdiMS5iICogcmdiMi5iIC8gMjU1KTtcbiAgICByZ2IxLmcgPSBNYXRoLmZsb29yKHJnYjEuZyAqIHJnYjIuZyAvIDI1NSk7XG4gICAgcmdiMS5yID0gTWF0aC5mbG9vcihyZ2IxLnIgKiByZ2IyLnIgLyAyNTUpO1xuICAgIHJldHVybiBuZXcgVGlueUNvbG9yKCdyZ2LCoCcgKyByZ2IxLnIgKyAnwqAnICsgcmdiMS5nICsgJ8KgJyArIHJnYjEuYik7XG4gIH1cblxuICBwcml2YXRlIGdldENvbG9yT2JqZWN0KHZhbHVlOiBUaW55Q29sb3IpIHtcbiAgICBjb25zdCBjID0gbmV3IFRpbnlDb2xvcih2YWx1ZSk7XG4gICAgcmV0dXJuIHtyZ2I6IGMudG9SZ2IoKSwgaXNMaWdodDogYy5pc0xpZ2h0KCl9O1xuICB9XG5cbn1cbiJdfQ==